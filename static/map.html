<!-- Output Container -->
<div class="inner-output-container">
    <div class="map-container">
        <svg viewBox="0 0 1000 595" xmlns="http://www.w3.org/2000/svg">
            <!-- Colors -->
            <style>
                .colors-for-this-map {
                    color: #be6728,
                        #ff9114,
                        #8214ff00,
                        #008000,
                        #ff5b5b56,
                        #757575,
                }

                .circle.zoomed {
                    transform: scale(1.2);
                    /* Zoom effect */
                }

                .circle-container.faded .circle {
                    opacity: 0.3;
                    /* Transparency for non-highlighted stations */
                    transition: opacity 0.7s ease;
                }

                .circle {
                    transition: transform 0.7s ease, opacity 0.7s ease;
                }

                .circle.golden {
                    fill: gold;
                    stroke: #d4af37;
                }

                .circle.initial-destination {
                    fill: #33FF57 !important;
                    /* Green color */
                    stroke: #19495c !important;
                }

                .circle.final-destination {
                    fill: #FF5733 !important;
                    /* Red color */
                    stroke: #d32f2f !important;
                }
            </style>

            <!-- Metro Lines with Glow Effect -->
            <!-- LRT1 Line (Green) - C-shaped -->
            <path d="M460 50 
                      C230 50, 180 100, 180 300
                      C210 500, 230 550, 330 550" stroke="#008000" stroke-width="10" fill="none"
                stroke-linecap="round" />


            <!-- LRT2 Line (Yellow) -->
            <path d="M230 250 L735 250" stroke="#FFFF00" stroke-width="10" fill="none" stroke-linecap="round" />

            <path d="M740 250 L900 270" stroke="#FFFF00" stroke-width="10" fill="none" stroke-linecap="round" />

            <!-- MRT3 Line (Blue) -->
            <path d="M595 250 595 345" stroke="#0000FF" stroke-width="10" fill="none" stroke-linecap="round" />

            <path d="M595 250 534 73" stroke="#0000FF" stroke-width="10" fill="none" stroke-linecap="round" />

            <path d="M440 400 590 345" stroke="#0000FF" stroke-width="10" fill="none" stroke-linecap="round" />

            <path d="M250 400 L440 400" stroke="#0000FF" stroke-width="10" fill="none" stroke-linecap="round" />
            </g>
            <!-- Stations -->
            <g class="stations">
                <!-- LRT1 Stations -->
                <g fill="#008000">
                    <!-- Regular stations -->
                    <g>

                        <!-- Fernando Poe Jr -->
                        <circle cx="465" cy="50" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="459" y="44" width="12" height="12" href="/static/images/train.png" />
                        <text x="445" y="30" font-size="15">Fernando Poe Jr</text>

                        <!-- Balintawak -->
                        <circle cx="430" cy="50" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="423" y="44" width="12" height="12" href="/static/images/train.png" />
                        <text x="415" y="35" font-size="15" transform="rotate(30, 360, 90)">Balintawak</text>

                        <!-- Monumento -->
                        <circle cx="385" cy="53" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="379" y="47" width="12" height="12" href="/static/images/train.png" />
                        <text x="380" y="55" font-size="15" transform="rotate(30, 360, 90)">Monumento</text>

                        <!-- 5th Avenue -->
                        <circle cx="350" cy="56" r="5" fill="png" stroke="#008000" stroke-width="10" />
                        <image x="344" y="50" width="12" height="12" href="/static/images/train.png" />
                        <text x="350" y="80" font-size="15" transform="rotate(30, 360, 90)">5th Avenue</text>

                        <!-- R. Papa -->
                        <circle cx="310" cy="63" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="304" y="56" width="12" height="12" href="/static/images/train.png" />
                        <text x="260" y="45" font-size="15">R. Papa</text>

                        <!-- Abad Santos-->
                        <circle cx="278" cy="73" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="272" y="67" width="12" height="12" href="/static/images/train.png" />
                        <text x="185" y="60" font-size="15">Abad Santos</text>

                        <!-- Blumentritt -->
                        <circle cx="248" cy="87" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="242" y="82" width="12" height="12" href="/static/images/train.png" />
                        <text x="165" y="85" font-size="15">Blumentritt</text>

                        <!-- Tayuman -->
                        <circle cx="220" cy="110" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="214" y="105" width="12" height="12" href="/static/images/train.png" />
                        <text x="147" y="110" font-size="15">Tayuman</text>

                        <!-- Bambang -->
                        <circle cx="205" cy="135" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="199" y="129" width="12" height="12" href="/static/images/train.png" />
                        <text x="130" y="138" font-size="15">Bambang</text>

                        <!-- Doroteo Jose -->
                        <circle cx="198" cy="160" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="192" y="155" width="12" height="12" href="/static/images/train.png" />
                        <text x="25" y="165" font-size="15">Doroteo Jose (Transfer)</text>

                        <!-- Carriedo -->
                        <circle cx="190" cy="185" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="184" y="179" width="12" height="12" href="/static/images/train.png" />
                        <text x="120" y="190" font-size="15">Carriedo</text>

                        <!-- Central Terminal -->
                        <circle cx="185" cy="210" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="179" y="204" width="12" height="12" href="/static/images/train.png" />
                        <text x="60" y="215" font-size="15">Central Terminal</text>

                        <!-- United Nations -->
                        <circle cx="183" cy="235" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="177" y="230" width="12" height="12" href="/static/images/train.png" />
                        <text x="70" y="238" font-size="15">United Nations</text>

                        <!-- Pedro Gil -->
                        <circle cx="180" cy="260" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="174" y="254" width="12" height="12" href="/static/images/train.png" />
                        <text x="100" y="263" font-size="15">Pedro Gil</text>

                        <!-- Quirino Ave. -->
                        <circle cx="180" cy="285" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="174" y="279" width="12" height="12" href="/static/images/train.png" />
                        <text x="85" y="290" font-size="15">Quirino Ave.</text>

                        <!-- Vito Cruz -->
                        <circle cx="180" cy="310" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="174" y="304" width="12" height="12" href="/static/images/train.png" />
                        <text x="100" y="315" font-size="15">Vito Cruz</text>

                        <!-- Gil Puyat-->
                        <circle cx="185" cy="340" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="179" y="334" width="12" height="12" href="/static/images/train.png" />
                        <text x="115" y="345" font-size="15">Gil Puyat</text>

                        <!-- Libertad -->
                        <circle cx="192" cy="370" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="186" y="364" width="12" height="12" href="static/images/train.png" />
                        <text x="125" y="378" font-size="15">Libertad</text>

                        <!-- EDSA -->
                        <circle cx="198" cy="400" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="192" y="394" width="12" height="12" href="static/images/train.png" />
                        <text x="50" y="405" font-size="15">EDSA (Interchange)</text>

                        <!-- Baclaran -->
                        <circle cx="203" cy="430" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="197" y="425" width="12" height="12" href="static/images/train.png" />
                        <text x="130" y="438" font-size="15">Baclaran</text>

                        <!-- Redemptorist-Aseana -->
                        <circle cx="210" cy="455" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="204" y="450" width="12" height="12" href="static/images/train.png" />
                        <text x="45" y="460" font-size="15">Redemptorist-Aseana</text>

                        <!-- MIA Road -->
                        <circle cx="220" cy="480" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="215" y="475" width="12" height="12" href="static/images/train.png" />
                        <text x="140" y="490" font-size="15">MIA Road</text>

                        <!-- PITX -->
                        <circle cx="235" cy="510" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="230" y="505" width="12" height="12" href="static/images/train.png" />
                        <text x="185" y="520" font-size="15">PITX</text>

                        <!-- Ninoy Aquino Avenue -->
                        <circle cx="260" cy="535" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="254" y="530" width="12" height="12" href="static/images/train.png" />
                        <text x="130" y="550" font-size="15">Ninoy Aquino Ave. </text>

                        <!-- Dr. Santos -->
                        <circle cx="330" cy="550" r="5" fill="" stroke="#008000" stroke-width="10" />
                        <image x="324" y="544" width="12" height="12" href="static/images/train.png" />
                        <text x="300" y="580" font-size="15">Dr. Santos </text>
                    </g>
                </g>

                <!-- LRT2 Stations -->
                <g fill="#FFFF00">
                    <!-- Regular stations -->
                    <g>
                        <circle cx="233" cy="250" r="1" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="233" y="250" width="12" height="12" href="static/images/train.png" />
                        <text x="221" y="275" font-size="12">Recto</text>
                        <text x="215" y="287" font-size="10">(Transfer)</text>

                        <!-- Legarda -->
                        <circle cx="290" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="284" y="244" width="12" height="12" href="static/images/train.png" />
                        <text x="271" y="234" font-size="12">Legarda</text>

                        <!-- Pureza -->
                        <circle cx="340" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="334" y="244" width="12" height="12" href="static/images/train.png" />
                        <text x="324" y="234" font-size="12">Pureza</text>

                        <!-- V. Mapa -->
                        <circle cx="389" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="384" y="244" width="12" height="12" href="static/images/train.png" />
                        <text x="369" y="234" font-size="12">V. Mapa</text>

                        <!-- J. Ruiz -->
                        <circle cx="438" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="433" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="422" y="234" font-size="12">J. Ruiz</text>

                        <!-- Gilmore -->
                        <circle cx="487" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="481" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="468" y="234" font-size="12">Gilmore</text>

                        <!-- Betty Go-Belmonte -->
                        <circle cx="545" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="539" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="525" y="222" font-size="11">Betty Go-</text>
                        <text x="525" y="234" font-size="11">Belmonte</text>

                        <!-- Lrt 2-Araneta Center-Cubao -->
                        <circle cx="620" cy="250" r="10" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="614" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="605" y="208" font-size="11">Lrt 2-Araneta</text>
                        <text x="605" y="220" font-size="11">Center-Cubao</text>
                        <text x="605" y="232" font-size="10">(Transfer)</text>

                        <!-- Anonas -->
                        <circle cx="680" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="675" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="670" y="234" font-size="12">Anonas</text>

                        <!-- Katipunan -->
                        <circle cx="740" cy="250" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="735" y="245" width="12" height="12" href="static/images/train.png" />
                        <text x="720" y="234" font-size="12">Katipunan</text>

                        <!-- Santolan -->
                        <circle cx="790" cy="256" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="784" y="250" width="12" height="12" href="static/images/train.png" />
                        <text x="785" y="240" font-size="12">Santolan</text>

                        <!-- Marikina-Pasig -->
                        <circle cx="844" cy="263" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="839" y="258" width="12" height="12" href="static/images/train.png" />
                        <text x="840" y="234" font-size="12">Marikina-</text>
                        <text x="840" y="247" font-size="12">Pasig</text>

                        <!-- Antipolo -->
                        <circle cx="900" cy="270" r="5" fill="" stroke="#FFFF00" stroke-width="10" />
                        <image x="894" y="265" width="12" height="12" href="static/images/train.png" />
                        <text x="880" y="255" font-size="12">Antipolo</text>
                    </g>
                </g>

                <!-- MRT3 Stations -->
                <g fill="#0000FF">
                    <!-- Regular stations -->
                    <g>
                        <!-- North Avenue -->
                        <circle cx="535" cy="75" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="528" y="69" width="12" height="12" href="static/images/train.png" />
                        <text x="550" y="75" font-size="12">North Avenue</text>

                        <!-- Quezon Avenue -->
                        <circle cx="550" cy="120" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="544" y="115" width="12" height="12" href="static/images/train.png" />
                        <text x="570" y="123" font-size="12">Quezon Avenue</text>

                        <!-- GMA Kamuning -->
                        <circle cx="567" cy="170" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="561" y="164" width="12" height="12" href="static/images/train.png" />
                        <text x="588" y="174" font-size="12">GMA Kamuning</text>

                        <!-- Mrt 3-Araneta Center-Cubao -->
                        <circle cx="595" cy="285" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="590" y="280" width="12" height="12" href="static/images/train.png" />
                        <text x="493" y="288" font-size="12">Mrt 3-Araneta</text>
                        <text x="493" y="300" font-size="12">Center-Cubao</text>
                        <text x="493" y="315" font-size="12">(Transfer)</text>

                        <!-- Santolan-Annapolis -->
                        <circle cx="595" cy="315" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="589" y="310" width="12" height="12" href="static/images/train.png" />
                        <text x="610" y="319" font-size="12">Santolan-Annapolis</text>

                        <!-- Ortigas -->
                        <circle cx="595" cy="342" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="589" y="336" width="12" height="12" href="static/images/train.png" />
                        <text x="610" y="345" font-size="12">Ortigas</text>

                        <!-- Shaw Boulevard -->
                        <circle cx="565" cy="355" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="559" y="350" width="12" height="12" href="static/images/train.png" />
                        <text x="575" y="370" font-size="12">Shaw Boulevard</text>

                        <!-- Boni -->
                        <circle cx="515" cy="373" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="509" y="368" width="12" height="12" href="static/images/train.png" />
                        <text x="528" y="390" font-size="12">Boni</text>

                        <!-- Guadalupe -->
                        <circle cx="475" cy="388" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="469" y="383" width="12" height="12" href="static/images/train.png" />
                        <text x="480" y="409" font-size="12">Guadalupe</text>

                        <!-- Buendia -->
                        <circle cx="440" cy="400" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="434" y="395" width="12" height="12" href="static/images/train.png" />
                        <text x="419" y="425" font-size="12">Buendia</text>

                        <!-- Ayala-->
                        <circle cx="390" cy="400" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="384" y="395" width="12" height="12" href="static/images/train.png" />
                        <text x="375" y="427" font-size="12">Ayala</text>

                        <!-- Magallanes -->
                        <circle cx="340" cy="400" r="6" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="334" y="395" width="12" height="12" href="static/images/train.png" />
                        <text x="310" y="427" font-size="12">Magallanes</text>

                        <!-- Taft Avenue -->
                        <circle cx="250" cy="400" r="10" fill="" stroke="#0000FF" stroke-width="10" />
                        <image x="244" y="395" width="12" height="12" href="static/images/train.png" />
                        <text x="220" y="427" font-size="12">Taft Avenue</text>
                        <text x="225" y="440" font-size="12">(Transfer)</text>
                    </g>
                </g>
            </g>
            </g>


            <!-- Transfer Connection Line -->

            <!-- LRT 2 to MRT 3 -->
            <path d="M620 250 
                     L620 285 
                     L591 285" stroke="#808080" stroke-width="3" stroke-dasharray="3" fill="none" />

            <!-- LRT 2 to LRT 1 -->
            <path d="M200 160
                     L233 228
                     L233 250" stroke="#808080" stroke-width="3" stroke-dasharray="3" fill="none" />

            <!-- LRT 1 to MRT 3 -->
            <path d="M200 400
                     L215 400
                     L250 400" stroke="#808080" stroke-width="3" stroke-dasharray="3" fill="none" />

            <!-- Legend -->
            <g transform="translate(750, 450)">
                <rect width="200" height="120" fill="none" fill-opacity="0.9" rx="10" />
                <text x="20" y="40" font-family="Arial" font-weight="bold" font-size="14">Train Stations</text>

                <line x1="20" y1="60" x2="60" y2="60" stroke="#008000" stroke-width="4" />
                <text x="70" y="65" font-family="Arial" font-size="12">LRT-1</text>

                <line x1="20" y1="85" x2="60" y2="85" stroke="#FFFF00" stroke-width="4" />
                <text x="70" y="90" font-family="Arial" font-size="12">LRT-2</text>

                <line x1="20" y1="110" x2="60" y2="110" stroke="#0000FF" stroke-width="4" />
                <text x="70" y="115" font-family="Arial" font-size="12">MRT-3</text>
                <line x1="20" y1="135" x2="60" y2="135" stroke="#808080" stroke-width="4" stroke-dasharray="4,2" />
                <text x="70" y="140" font-family="Arial" font-size="12">Transfer Station</text>
            </g>

        </svg>
        <script>
            // Helper to populate stations dropdown
            function populateStations(train, dropdownId) {
                const dropdown = document.getElementById(dropdownId);
                dropdown.innerHTML = '<option value="" disabled selected>Select a station</option>';

                if (train in trainStations) {
                    trainStations[train].forEach(station => {
                        const option = document.createElement('option');
                        option.value = station;
                        option.textContent = station;
                        dropdown.appendChild(option);
                    });
                }
            }

            document.getElementById('initialTrain').addEventListener('change', function () {
                const train = this.value;
                populateStations(train, 'start');
            });

            document.getElementById('finalTrain').addEventListener('change', function () {
                const train = this.value;
                populateStations(train, 'end');
            });

            // Function to apply the "golden", "green", and "red" classes to circles
            function highlightStations(stationsInRoute, start, end) {
                const circles = document.querySelectorAll('.circle-container');

                circles.forEach(circleContainer => {
                    const stationText = circleContainer.querySelector('.circle-text').textContent.trim();
                    const circle = circleContainer.querySelector('.circle');

                    // Remove all highlighting classes first
                    circle.classList.remove('golden', 'initial-destination', 'final-destination', 'zoomed');
                    circleContainer.classList.add('faded'); // Apply transparent effect by default

                    if (stationsInRoute.includes(stationText)) {
                        circle.classList.add('golden');
                        circle.classList.add('zoomed');
                        circleContainer.classList.remove('faded');
                    }

                    if (stationText === start) {
                        circle.classList.add('initial-destination');
                        circle.classList.remove('faded');
                    }

                    if (stationText === end) {
                        circle.classList.add('final-destination');
                        circle.classList.remove('faded');
                    }
                });
            }

            document.getElementById('routeForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const start = document.getElementById('start').value;
                const end = document.getElementById('end').value;
                const resultDiv = document.getElementById('result');

                if (start && end) {
                    fetch('/shortest_path', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ start, end })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                resultDiv.innerHTML = `
                                    <div class="result-container error">
                                        <p>${data.error}</p>
                                    </div>
                                `;
                            } else {
                                const pathHtml = data.path.map((station, index) => {
                                    let stationClass = 'station-box';
                                    if (station === start) stationClass += ' start-station';
                                    if (station === end) stationClass += ' end-station';

                                    return `
                                        <div class="${stationClass}">
                                            <span>${station}</span>
                                        </div>
                                        ${index < data.path.length - 1 ? '<div class="arrow">→</div>' : ''}
                                    `;
                                }).join('');

                                resultDiv.innerHTML = `
                                    <div class="result-container">
                                        <h3>Shortest Route</h3>
                                        <div class="path-container">
                                            ${pathHtml}
                                        </div>
                                        <p><strong>Distance:</strong> ${data.distance} km</p>
                                    </div>
                                    <p class="route-text">Here is the shortest path from ${start} to ${end}:</p>
                                `;
                                highlightStations(data.path, start, end);
                            }
                            resultDiv.style.display = 'block';
                        })
                        .catch(error => {
                            console.error('Fetch error:', error);
                            resultDiv.innerHTML = `
                                <div class="result-container error">
                                    <p>An unexpected error occurred. Please check your network and try again.</p>
                                </div>
                            `;
                            resultDiv.style.display = 'block';
                        });
                }
            });
        </script>